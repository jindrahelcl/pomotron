{% extends "base.html" %}

{% block title %}Chat Test - StoryTRON{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ’¬ Chat test s aktivnÃ­m agentem</h2>
    <p>TestovÃ¡nÃ­ komunikace s aktuÃ¡lnÄ› aktivnÃ­m agentem pÅ™es StoryTRON API.</p>
</div>

<div class="card">
    <form method="POST">
        <div class="form-group">
            <label for="message">ZprÃ¡va pro agenta:</label>
            <input type="text"
                   class="form-control"
                   id="message"
                   name="message"
                   placeholder="NapiÅ¡te zprÃ¡vu..."
                   value="{{ user_message or '' }}"
                   required>
        </div>
        <button type="submit" class="btn">ğŸ“¤ Poslat zprÃ¡vu</button>
    </form>
</div>

{% if user_message and bot_response %}
<div class="card">
    <h3>ğŸ“ Konverzace</h3>

    <div class="chat-message" style="border-left-color: #ffff00;">
        <strong>ğŸ‘¤ Vy:</strong>
        <p>{{ user_message }}</p>
    </div>

    {% if bot_response %}
    <div class="chat-message" style="border-left-color: #00ff00;">
        <strong>ğŸ¤– Agent ({{ bot_response.active_agent if bot_response.active_agent else 'N/A' }}):</strong>
        <p>{{ bot_response.agent_response if bot_response.agent_response else 'Å½Ã¡dnÃ¡ odpovÄ›Ä' }}</p>
        {% if bot_response.timestamp %}
        <small style="color: #888;">{{ bot_response.timestamp }}</small>
        {% endif %}
    </div>
    {% else %}
    <div class="chat-message error">
        <strong>âŒ Chyba:</strong>
        <p>NepodaÅ™ilo se zÃ­skat odpovÄ›Ä od agenta. StoryTRON moÅ¾nÃ¡ nenÃ­ dostupnÃ½.</p>
    </div>
    {% endif %}
</div>
{% endif %}

<div class="card">
    <h3>â„¹ï¸ RychlÃ© zprÃ¡vy</h3>
    <p>KliknÄ›te pro rychlÃ© testovÃ¡nÃ­:</p>
    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
        <button class="btn" onclick="sendQuickMessage('Ahoj!')">ğŸ‘‹ Ahoj!</button>
        <button class="btn" onclick="sendQuickMessage('Jak se mÃ¡Å¡?')">â“ Jak se mÃ¡Å¡?</button>
        <button class="btn" onclick="sendQuickMessage('Å˜ekni mi nÄ›co zajÃ­mavÃ©ho')">ğŸŒŸ ZajÃ­mavÃ©</button>
        <button class="btn" onclick="sendQuickMessage('PomoÅ¾ mi s problÃ©mem')">ğŸ†˜ Pomoc</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function sendQuickMessage(message) {
    document.getElementById('message').value = message;
    document.querySelector('form').submit();
}

// Focus na input pÅ™i naÄtenÃ­ strÃ¡nky
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('message').focus();
});

// Submit na Enter
document.getElementById('message').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        document.querySelector('form').submit();
    }
});
</script>
{% endblock %}
